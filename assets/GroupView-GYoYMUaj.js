import{d as R,aw as pe,f as r,j as X,ao as he,a as J,aT as ve,l as H,c as i,m as S,n as o,q as g,t as N,G as z,U as ne,e as F,x as O,y as k,aa as Q,a0 as ke,z as fe,I as He,J as Fe,b as le,r as y,aq as Ne,w as j,O as ye,C as M,D as me,s as K,F as Ae,k as Ue,aW as Ee,bt as Oe,o as Le,P as ze,bu as Pe,W as ae,bv as Ve,R as oe,B as je,by as Me,bx as Je,a5 as qe,g as Re}from"./main-A7BwrMDB.js";import{_ as ce}from"./BaseIcon.vue_vue_type_script_setup_true_lang-io_05Ke-.js";import{C as q}from"./color-Ih_vWK5s.js";import{A as We,B as Ye,u as Ke,C as Qe,a as Xe,b as Ze,c as xe,d as et}from"./ChatMeeting-8plBbq7X.js";import{u as _e}from"./use-typing-AKUAkgng.js";import{I as tt,c as st,u as at,A as ot,D as rt,B as ge,a as nt,N as lt}from"./NoActivity-NQRdbcFc.js";import{B as we,G as ct}from"./BaseAvatar-cLayq0TK.js";import{_ as W}from"./_plugin-vue_export-helper-x3n3nnut.js";import{I as ut}from"./IPhone-TdHhqDC-.js";import{f as I,S as it}from"./SidebarToogle-U6gwKzHv.js";import{u as dt}from"./IThreeDots-CDVNklVX.js";import{_ as mt}from"./BaseModal.vue_vue_type_style_index_0_lang-fG62cZ1v.js";import{G as pt}from"./GlobalTable-zZH7TUnX.js";import{_ as ht}from"./index-yeKH0v8d.js";import{_ as vt}from"./IGroupV1.vue_vue_type_script_setup_true_lang-O-Dolldc.js";import"./index-Gr4YhlML.js";import"./index-35H_NU9g.js";const ft={class:"author"},yt={class:"avatar"},_t={class:"contents"},gt={class:"bubble"},wt={class:"participants"},bt=["title"],It={key:1},re=5,St=R({__name:"BaseGroupChatConference",props:{message:{}},setup(D){pe(f=>({a1a9878a:r(q).SPAGray300}));const c=D,{t:d}=X(),w=he(),{getNameByUserId:G}=J(),{acceptConference:_}=ve(),$=H(()=>{const f=JSON.parse(c.message.content);return f.participants.sort((u,p)=>Number(p.in_meeting)-Number(u.in_meeting)),f.participants.length>re&&f.participants.splice(re-1),f}),m=H(()=>{const f=JSON.parse(c.message.content);let u=!1;const p=f.participants.filter(t=>!$.value.participants.some(e=>t.user_id===e.user_id));let h="";if(p.length){u=!0;for(const t of p)h+=G(t.user_id)+`
`}return{showPlusIcon:u,title:h,qtd:f.participants.length-re+1}});function B(){_({message:c.message,token:$.value.token})}return(f,u)=>(i(),S(z,null,[o("div",ft,[o("figure",yt,[g(tt)])]),o("div",_t,[o("div",gt,[o("h2",null,N(r(d)("Meeting")),1),o("div",wt,[(i(!0),S(z,null,ne($.value.participants,p=>(i(),F(we,{key:p.user_id,src:`${r(w).avatars[p.user_id][32]}`,status:void 0,size:"1.5rem",class:O(["cursor-pointer",p.in_meeting?"":"leftConference"]),title:r(G)(p.user_id)},null,8,["src","class","title"]))),128)),m.value.showPlusIcon?(i(),S("div",{key:0,title:m.value.title,class:"avatar plusUsers"},[o("span",null,"+"+N(m.value.qtd),1)],8,bt)):k("",!0),r(st)($.value.status,c.message.created_at)?(i(),S("p",It,N(r(d)("Ended")),1)):(i(),S("button",{key:2,class:"primary-btn text-uppercase",onClick:B},N(r(d)("Join")),1))])])])],64))}}),Gt=W(St,[["__scopeId","data-v-9376b898"]]),$t={class:"author"},Tt={class:"avatar"},Ct=["title"],Dt={class:"bubble"},Bt=R({__name:"BaseGroupChatCall",props:{message:{},loggedUserId:{}},setup(D){const c=D,{t:d}=X(),w=H(()=>JSON.parse(c.message.content)),G=H(()=>{if(w.value.status=="FINISHED"){const _=w.value.duration;return _<60*Q.Second?I(_,"'"+d("Lasted")+"' s 'sec'"):_<60*Q.Minute?I(_,"'"+d("Lasted")+"' m 'min' s 'sec'"):I(_,"'"+d("Lasted")+"' h 'hour' m 'min' s 'sec'")}return d(ke.capitalize(w.value.status))});return(_,$)=>(i(),S(z,null,[o("div",$t,[o("figure",Tt,[g(ut)])]),o("div",{class:"contents",title:c.message.src_user===_.loggedUserId?r(d)("Called From")+" "+w.value.src_number:r(d)("Received From")+" "+w.value.dst_number},[o("div",Dt,[o("h2",null,N(r(d)("Call")),1),o("p",null,[g(ce,{name:c.message.src_user===_.loggedUserId?"arrow-up-right":"arrow-down-left",size:12},null,8,["name"]),fe(" "+N(c.message.src_user===_.loggedUserId?w.value.dst_number:w.value.src_number)+" â€¢ "+N(G.value),1)])])],8,Ct)],64))}}),kt=W(Bt,[["__scopeId","data-v-b2d3cb2e"]]),Ht=D=>(He("data-v-35c9a4ad"),D=D(),Fe(),D),Ft=["data-message"],Nt={key:1,class:"base-chat-message-not-avatar"},At=Ht(()=>o("div",null,null,-1)),Ut={class:"base-chat-message"},Et=["innerHTML"],Ot={key:1,class:"base-chat-attachments"},Lt=R({__name:"BaseGroupMessage",props:{chatGroupMessage:{},me:{type:Boolean},hasAvatar:{type:Boolean},hasTime:{type:Boolean},hasName:{type:Boolean}},setup(D){const{fileData:c,filesAttachments:d,modalDeleteAttachment:w,deleteAttachmentIsIsVisible:G,setDeleteAttachmentIsOpen:_,handleGroupDeleteAttachment:$,handleSelectedAttachment:m,onMouseover:B,onMouseLeave:f}=at(),u=D,{avatar:p}=dt({me:u.me,srcUser:u.chatGroupMessage.src_user}),{getNameByUserId:h}=J(),t=H(()=>e=>{if(e.type==="attachment"){const s=JSON.parse(e.content).message,n=s||"";return u.hasName?`<span class="font-size-12 font-weight-700" style="color: ${q.TextPrimary}">${h(e.src_user)}</span><br>`+n:n}return u.hasName?`<span class="font-size-12 font-weight-700" style="color: ${q.TextPrimary}">${h(e.src_user)}</span><br>`+e.content:e.content});return(e,s)=>(i(),S(z,null,[o("div",{class:O(["base-chat-message-container",{me:e.me}]),"data-message":e.chatGroupMessage.id,onMouseover:s[0]||(s[0]=(...n)=>r(B)&&r(B)(...n)),onMouseleave:s[1]||(s[1]=(...n)=>r(f)&&r(f)(...n))},[o("div",{class:O(["base-chat-message-content",{me:e.me}])},[e.hasAvatar?(i(),F(we,{key:0,class:"message-sms-content-avatar",size:"1.5rem",status:r(p).status,src:r(p).src},null,8,["status","src"])):(i(),S("div",Nt)),At,o("div",Ut,[t.value(e.chatGroupMessage)?(i(),S("div",{key:0,innerHTML:t.value(e.chatGroupMessage)},null,8,Et)):k("",!0),e.chatGroupMessage.type==="attachment"?(i(),S("div",Ot,[(i(!0),S(z,null,ne(JSON.parse(e.chatGroupMessage.content).files,(n,b)=>(i(),F(ot,{key:b,"file-data":n},null,8,["file-data"]))),128))])):k("",!0)]),r(G)&&e.chatGroupMessage.type==="attachment"&&e.me&&r(d)(JSON.parse(e.chatGroupMessage.content).files).length>0?(i(),F(rt,{key:2,files:r(d)(JSON.parse(e.chatGroupMessage.content).files),me:e.me,onChange:r(_),onDelete:r(m)},null,8,["files","me","onChange","onDelete"])):k("",!0)],2),e.hasTime?(i(),F(ge,{key:0,"date-string":e.chatGroupMessage.created_at,class:O(["base-chat-message-time",{me:e.me}])},null,8,["date-string","class"])):k("",!0)],42,Ft),r(w)?(i(),F(We,{key:0,"file-data":r(c),onDelete:s[2]||(s[2]=n=>r($)(n,e.chatGroupMessage.created_at,r(d)(JSON.parse(e.chatGroupMessage.content).files))),onClose:s[3]||(s[3]=n=>w.value=!1)},null,8,["file-data"])):k("",!0)],64))}}),zt=W(Lt,[["__scopeId","data-v-35c9a4ad"]]),Pt={class:"base-chat-container"},Vt=["data-message"],jt=["data-message"],Mt=R({__name:"BaseGroupChat",props:{chatGroupMessages:{},height:{}},setup(D){pe(t=>({"35585ccc":t.height}));const c=J(),d=le(),{typingGroup:w,typingGroupUserId:G}=_e(),_=y(""),$=y(),m=H(()=>$.value?w.value(_.value,$.value).length>0:!1);function B(t){const e=J();return t.type=="conference"?t.src_user===e.user.userId?"my party meeting item":"party meeting item":t.type=="call"?t.src_user===e.user.userId?"my call item":"party call item":t.src_user===e.user.userId?"my message item":"party message item"}const f=H(()=>(t,e)=>{if(t.length===1||e===0)return!0;const n=I(new Date(t[e].created_at),"dd-MM-yyyy"),b=I(new Date(t[e-1].created_at),"dd-MM-yyyy");return n!==b}),u=H(()=>(t,e)=>{if(t.length===1||e===0)return!0;const n=t[e].type,b=t[e-1].type,A=I(new Date(t[e].created_at),"dd-MM-yyyy"),T=I(new Date(t[e-1].created_at),"dd-MM-yyyy"),L=t[e].src_user,U=t[e-1].src_user;if(n!=="message"||b!=="message"||n!==b||L!==U||A!==T)return!0;const P=I(new Date(t[e].created_at),"hh:mm"),E=I(new Date(t[e-1].created_at),"hh:mm");return P!==E}),p=H(()=>(t,e)=>{const s=t.length-1;if(t.length===1||s===e)return!0;const n=t[e].type,b=t[e+1].type,A=I(new Date(t[e].created_at),"dd-MM-yyyy"),T=I(new Date(t[e+1].created_at),"dd-MM-yyyy"),L=t[e].src_user,U=t[e+1].src_user;if(n!=="message"||b!=="message"||n!==b||L!==U||A!==T)return!0;const P=I(new Date(t[e].created_at),"hh:mm"),E=I(new Date(t[e+1].created_at),"hh:mm");return P!==E}),h=H(()=>(t,e)=>{if(t.length===1||e===0)return!0;const n=t[e].type,b=t[e-1].type,A=I(new Date(t[e].created_at),"dd-MM-yyyy"),T=I(new Date(t[e-1].created_at),"dd-MM-yyyy"),L=t[e].src_user,U=t[e-1].src_user;if(n!=="message"||b!=="message"||n!==b||L!==U||A!==T)return!0;const P=I(new Date(t[e].created_at),"hh:mm"),E=I(new Date(t[e-1].created_at),"hh:mm");return P!==E});return Ne(()=>{_.value=d.name,$.value=parseInt(d.params.id,10)}),(t,e)=>(i(),S("div",Pt,[(i(!0),S(z,null,ne(t.chatGroupMessages,(s,n)=>(i(),S(z,{key:s.id},[f.value(t.chatGroupMessages,n)?(i(),F(Ye,{key:0,"date-string":s.created_at},null,8,["date-string"])):k("",!0),s.type=="message"||s.type=="attachment"?(i(),F(zt,{key:1,"has-avatar":u.value(t.chatGroupMessages,n),"chat-group-message":s,me:r(c).user.userId===s.src_user,"has-time":p.value(t.chatGroupMessages,n),"has-name":h.value(t.chatGroupMessages,n)},null,8,["has-avatar","chat-group-message","me","has-time","has-name"])):k("",!0),s.type==="conference"?(i(),S("div",{key:2,"data-message":s.id,class:O(B(s))},[g(Gt,{message:s},null,8,["message"])],10,Vt)):k("",!0),s.type==="call"?(i(),S("div",{key:3,"data-message":s.id,class:O(B(s))},[g(kt,{"logged-user-id":r(c).user.userId,message:s},null,8,["logged-user-id","message"])],10,jt)):k("",!0),s.type!=="message"&&s.type!=="attachment"?(i(),F(ge,{key:4,"date-string":s.created_at,class:O(B(s))},null,8,["date-string","class"])):k("",!0)],64))),128)),m.value?(i(),F(nt,{key:0,class:O({"mt-3":t.chatGroupMessages.length===0}),"user-id":r(G)(Number($.value))},null,8,["class","user-id"])):k("",!0)]))}}),Jt=W(Mt,[["__scopeId","data-v-d3726a71"]]),qt={class:"m-4",style:{width:"280px"}},Rt={class:"input-group"},Wt=["placeholder"],Yt={class:"m-4 d-flex flex-column",style:{height:"110px"}},Kt={class:"font-size-14",style:{color:"#67748E"}},Qt={class:"d-flex justify-content-end"},Xt=R({__name:"AboutGroup",props:{modalGroup:{type:Boolean}},emits:["update:modalGroup"],setup(D,{emit:c}){const{t:d}=X(),w=le(),G=J(),_=D,$=c,m=y(_.modalGroup),B=y(""),f=y(""),u=y([]),p=[{headerName:d("User"),field:"name",sorted:!0}];function h(e){var n,b;const s=e.target.value;if(s==="")return u.value=((n=G.groupById(parseInt(f.value)))==null?void 0:n.users)??[];u.value=((b=G.groupById(parseInt(f.value)))==null?void 0:b.users.filter(A=>A.name.toLowerCase().includes(s.toLowerCase())))??[]}function t(){$("update:modalGroup",!1)}return j(()=>_.modalGroup,e=>m.value=e),j(m,e=>$("update:modalGroup",e)),j(()=>w.params.id,e=>{var s;f.value=e,u.value=((s=G.groupById(parseInt(f.value)))==null?void 0:s.users)??[]}),ye(()=>{var e;f.value=w.params.id,u.value=((e=G.groupById(parseInt(f.value)))==null?void 0:e.users)??[]}),(e,s)=>(i(),F(mt,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=n=>m.value=n),"max-width":"640px","min-height":"383px","max-height":"383px",scrollable:""},{header:M(()=>[o("span",{style:me({color:r(q).TextPrimary})},N(r(d)("About this Group")),5)]),body:M(()=>[o("div",qt,[o("div",Rt,[g(ce,{name:"search",size:18}),K(o("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>B.value=n),class:"form-control border-0",placeholder:r(d)("Search for user"),onInput:h},null,40,Wt),[[Ae,B.value]])])]),o("div",Yt,[g(pt,{columns:p,rows:u.value},null,8,["rows"]),u.value.length===0?(i(),S("div",{key:0,class:"d-flex flex-column h-100 flex-grow-1 justify-content-center align-items-center",style:me({borderTop:`1px solid ${r(q).Line}`})},[o("span",Kt,N(r(d)("No results found")),1)],4)):k("",!0)])]),footer:M(()=>[o("div",Qt,[o("button",{class:"primary-btn text-uppercase",onClick:t},N(r(d)("Done")),1)])]),_:1},8,["modelValue"]))}}),Zt=W(Xt,[["__scopeId","data-v-e62d4f35"]]),xt={id:"chat-container"},es={class:"chat-header"},ts={class:"chat-header-left"},ss={class:"chat-header-right chat-actions"},as={href:"javascript:",class:"call-container",disabled:""},os={class:"chat-body-outer"},rs={class:"loading-messages"},ns={class:"chat-body-inner"},ls=R({__name:"GroupView",setup(D){const c=le(),d=Ue(),w=J(),G=he(),{t:_}=X(),{participants:$}=Ee(),m=ve(),{typingGroup:B}=_e(),{resize:f}=Ke(),u=y(),p=y(""),h=y(),t=y(!1),e=y(!0),s=y(!1),n=y(0),b=y(0),A=y(),T=y(0),L=y(!0),U=y(!1),P=setInterval(async()=>{E()},3e4);window.addEventListener("online",E),window.addEventListener("offline",E);async function E(){const l=await Oe();l&&L.value===!1&&se(),L.value=l}const Z=H(()=>{const l=c.name,a=parseInt(c.params.id,10);return B.value(l,a)}),x=y(!1),ee=y(!1),te=H(()=>{const l=Ve.collect(m.messages).sortBy("created_at").all(),a=[];if(l.length===0)return a;for(const v of l)a.push({...v,day:I(new Date(v.created_at),"yyyyMMdd"),minute:I(new Date(v.created_at),"HHmm")});return a});function be(){x.value=!0}function ue(){p.value=c.params.id,p.value&&(m.setGroupId(parseInt(p.value)),u.value=w.groupById(parseInt(p.value)),u.value==null&&(d.push({name:oe.Home}),je(_("Group not found"))))}async function Ie(){var l,a;if((l=u.value)!=null&&l.favorite)return await Me(u.value.id),c.name===oe.FavoriteGroup&&d.replace({name:oe.Group,params:{id:p.value}}),u.value.favorite=!1;await Je((a=u.value)==null?void 0:a.id.toString(),"group"),u.value.favorite=!0}function se(){e.value=!0,ee.value=!0,t.value=!0;const l=c.query.dateCondition;l?m.searchMessage(l):m.getMessages(),setTimeout(()=>{const a=c.query.messageId;e.value=!1,a&&(Y(a),window.history.pushState({},document.title,window.location.pathname))},500),ee.value=!1}function Y(l=""){setTimeout(()=>{var a;if(h.value){const v=l?Ce(l):(a=h.value)==null?void 0:a.$el.scrollHeight;h.value.$el.scrollTop=v-h.value.$el.clientHeight}},100)}j(()=>c.params,(l,a)=>{!Object.prototype.hasOwnProperty.call(c.params,"id")||c.name!=="group"&&c.name!=="favorite-group"||l.id!==a.id&&(G.enableScrollLock(),ue(),m.readAllMessagesByGroupId(c.params.id),se())},{deep:!0}),j(()=>m.messages,(l,a)=>{var V,de;const v=(((V=h.value)==null?void 0:V.$el.scrollHeight)??0)-(((de=h.value)==null?void 0:de.$el.clientHeight)??0),C=c.query.messageId;qe(()=>{if(!s.value&&T.value>=.95*v&&!C&&Y(),(a==null?void 0:a.length)===0&&setTimeout(()=>{if(!C)return Y();Y(C),window.history.pushState({},document.title,window.location.pathname)},500),l&&l.length>0&&a&&a.length>0&&s.value&&!U.value){const Be=h.value.$el.scrollHeight-b.value;h.value.$el.scrollTop=n.value+Be}}),setTimeout(()=>{m.readAllMessagesByGroupId(c.params.id)},200)},{deep:!0}),Le(()=>{ue(),se(),m.readAllMessagesByGroupId(c.params.id)}),ze(()=>{clearInterval(P)});async function Se(l){clearTimeout(A.value),G.disableScrollLock();const a=l.target;T.value=a.scrollTop;const v=a.scrollHeight;s.value||T.value<=.15*v&&T.value>=.1*v&&(s.value=!0,n.value=T.value,b.value=v,await m.getBatchGroupMessages("oldest"),setTimeout(()=>{s.value=!1},2.5*Q.Second))}async function Ge(l){if(clearTimeout(A.value),t.value){t.value=!1;return}if(s.value)return;const a=l.target,v=a.offsetHeight;T.value=a.scrollTop;const C=a.scrollHeight;v+T.value>=.85*C&&v+T.value<=.95*C&&(s.value=!0,n.value=T.value,b.value=C,U.value=!0,m.readAllMessagesByGroupId(c.params.id),await m.getBatchGroupMessages("newest"),setTimeout(()=>{s.value=!1,U.value=!1},2.5*Q.Second)),v+T.value>=.98*C&&G.enableScrollLock()}const ie=y(),$e=y(0),{width:Te}=Pe(ie);j(Te,l=>$e.value=l),j(Z,l=>{var v,C;const a=(((v=h.value)==null?void 0:v.$el.scrollHeight)??0)-(((C=h.value)==null?void 0:C.$el.clientHeight)??0);l.length>0&&T.value>=.95*a&&Y()});function Ce(l){const a=document.querySelector(`[data-message="${l}"]`);let v=0;if(a){const C=a.offsetTop,V=a.clientHeight;v=C+V}return v>0?v:0}function De(l){if(h.value){const a=h.value.$el.scrollTop;h.value.$el.scrollTop=a+l}}return ye(()=>{f()}),(l,a)=>{var C;const v=Re("perfect-scrollbar");return i(),S(z,null,[o("main",xt,[o("div",{ref_key:"panelRef",ref:ie,class:"panel"},[o("div",es,[g(it),o("div",ts,[o("div",{class:"contact-info",onClick:be},[g(ct,{"background-color":"type-groups",radius:"5","container-size":"24"},{default:M(()=>[g(vt,{size:"15"})]),_:1}),g(r(ht),{as:"h2",size:16,weight:700,color:"brand-blue-500",class:"m-0"},{default:M(()=>[fe(N(r($)(u.value)),1)]),_:1})])]),o("div",ss,[o("ul",null,[o("li",{onClick:Ie},[o("button",{href:"javascript:",class:O(["favorite-container",{"is-favorite":(C=u.value)==null?void 0:C.favorite}])},[g(Qe,{class:"yellow"}),g(Xe,{class:"blue"})],2)]),o("li",null,[o("button",as,[g(Ze)])]),o("li",null,[o("button",{class:"meeting-container",href:"javascript:",onClick:a[0]||(a[0]=V=>r(m).newGroupConference(parseInt(p.value),r(w).groupUsersById(parseInt(p.value))))},[g(xe)])])])])]),o("div",os,[K(o("div",rs,[g(ce,{name:"loader",class:"feather feather-loader spin",size:"md",color:r(q).LineIcon},null,8,["color"])],512),[[ae,e.value]]),K(g(lt,null,null,512),[[ae,!e.value&&!Object.keys(te.value).length&&Z.value.length===0]]),K(o("div",ns,[g(v,{ref_key:"scrollbar",ref:h,"watch-options":!0,options:{suppressScrollY:ee.value},onPsScrollUp:Se,onPsScrollDown:Ge},{default:M(()=>[g(Jt,{"chat-group-messages":te.value},null,8,["chat-group-messages"])]),_:1},8,["options"])],512),[[ae,!e.value&&Object.keys(te.value).length||Z.value.length>0]])]),g(et,{onHeight:De})],512)]),g(Zt,{"modal-group":x.value,"onUpdate:modalGroup":a[1]||(a[1]=V=>x.value=V)},null,8,["modal-group"])],64)}}}),Ts=W(ls,[["__scopeId","data-v-3864e8d0"]]);export{Ts as default};
//# sourceMappingURL=GroupView-GYoYMUaj.js.map
