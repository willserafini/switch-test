import{d as K,l as D,c as l,m as d,n as r,x as E,e as N,f as o,y as p,G as U,U as ae,I as Ge,J as Xe,j as he,ao as Ke,aU as Qe,a as te,q as h,t as _,aa as se,a0 as pt,z as X,aw as ft,b as Ze,r as g,aq as ht,k as gt,af as _t,a1 as yt,aX as bt,aY as St,br as It,bs as wt,bt as Ct,w as ee,o as kt,P as Tt,bu as $t,O as Dt,C as ve,s as pe,W as fe,bv as Ye,B as Nt,bw as Ht,R as We,bx as Bt,a5 as Ft,g as At}from"./main-A7BwrMDB.js";import{_ as xe}from"./BaseIcon.vue_vue_type_script_setup_true_lang-io_05Ke-.js";import{C as Ot}from"./color-Ih_vWK5s.js";import{A as Ut,B as Et,u as Vt,C as Lt,a as Jt,b as Mt,c as zt,d as jt}from"./ChatMeeting-8plBbq7X.js";import{u as et}from"./use-typing-AKUAkgng.js";import{u as Pt}from"./use-user-agent-gNSz9J2a.js";import{B as ge}from"./BaseAvatar-cLayq0TK.js";import{u as Rt,A as qt,D as Yt,B as tt,I as Wt,c as Gt,a as Xt,N as Kt}from"./NoActivity-NQRdbcFc.js";import{u as Qt}from"./IThreeDots-CDVNklVX.js";import{_ as Q}from"./_plugin-vue_export-helper-x3n3nnut.js";import{I as Zt}from"./IPhone-TdHhqDC-.js";import{f as I,S as xt}from"./SidebarToogle-U6gwKzHv.js";import{M as es}from"./MessageSms-vAK2MOtm.js";import{_ as ts}from"./NumbersList.vue_vue_type_style_index_0_lang-WD-r1fiN.js";import{_ as ss}from"./index-yeKH0v8d.js";import{P as as,a as rs}from"./PresenceVideo-m2skjI0f.js";import"./index-Gr4YhlML.js";import"./index-35H_NU9g.js";import"./isYesterday-klLVg_Mw.js";import"./BaseModal.vue_vue_type_style_index_0_lang-fG62cZ1v.js";const ns=S=>(Ge("data-v-a4fa9d28"),S=S(),Xe(),S),os=["data-message"],ls={key:1,class:"base-chat-message-not-avatar"},us=ns(()=>r("div",null,null,-1)),cs={class:"base-chat-message"},is=["innerHTML"],ds={key:1,class:"base-chat-attachments"},ms=K({__name:"BaseChatMessage",props:{chatMessage:{},me:{type:Boolean},hasAvatar:{type:Boolean},hasTime:{type:Boolean}},setup(S){const{fileData:u,filesAttachments:v,modalDeleteAttachment:y,deleteAttachmentIsIsVisible:w,setDeleteAttachmentIsOpen:f,handleDeleteAttachment:F,handleSelectedAttachment:A,onMouseover:H,onMouseLeave:k}=Rt(),T=S,{avatar:M}=Qt({me:T.me,srcUser:T.chatMessage.src_user}),t=D(()=>e=>e.type==="attachment"?JSON.parse(e.content).message:e.content);return(e,s)=>(l(),d(U,null,[r("div",{class:E(["base-chat-message-container",{me:e.me}]),"data-message":e.chatMessage.id,onMouseover:s[0]||(s[0]=(...m)=>o(H)&&o(H)(...m)),onMouseleave:s[1]||(s[1]=(...m)=>o(k)&&o(k)(...m))},[r("div",{class:E(["base-chat-message-content",{me:e.me}])},[e.hasAvatar?(l(),N(ge,{key:0,class:"message-sms-content-avatar",size:"1.5rem",status:o(M).status,src:o(M).src},null,8,["status","src"])):(l(),d("div",ls)),us,r("div",cs,[t.value(e.chatMessage)?(l(),d("div",{key:0,innerHTML:t.value(e.chatMessage)},null,8,is)):p("",!0),e.chatMessage.type==="attachment"?(l(),d("div",ds,[(l(!0),d(U,null,ae(JSON.parse(e.chatMessage.content).files,(m,O)=>(l(),N(qt,{key:O,"file-data":m},null,8,["file-data"]))),128))])):p("",!0)]),o(w)&&e.chatMessage.type==="attachment"&&e.me&&o(v)(JSON.parse(e.chatMessage.content).files).length>0?(l(),N(Yt,{key:2,files:o(v)(JSON.parse(e.chatMessage.content).files),me:e.me,onChange:o(f),onDelete:o(A)},null,8,["files","me","onChange","onDelete"])):p("",!0)],2),e.hasTime?(l(),N(tt,{key:0,"date-string":e.chatMessage.created_at,class:E(["base-chat-message-time",{me:e.me}])},null,8,["date-string","class"])):p("",!0)],42,os),o(y)?(l(),N(Ut,{key:0,"file-data":o(u),onDelete:s[2]||(s[2]=m=>o(F)(m,e.chatMessage.created_at,o(v)(JSON.parse(e.chatMessage.content).files))),onClose:s[3]||(s[3]=m=>y.value=!1)},null,8,["file-data"])):p("",!0)],64))}}),vs=Q(ms,[["__scopeId","data-v-a4fa9d28"]]),ps={class:"author"},fs={class:"avatar"},hs={class:"contents"},gs={class:"bubble"},_s={class:"participants"},ys={key:0},bs=K({__name:"BaseChatConference",props:{message:{}},setup(S){const u=S,{t:v}=he(),y=Ke(),{acceptConference:w}=Qe(),{getNameByUserId:f}=te(),F=D(()=>{const H=JSON.parse(u.message.content);return H.participants.sort((k,T)=>Number(T.in_meeting)-Number(k.in_meeting)),H});function A(){const H={...u.message,read:!!u.message.read};w({message:H,token:F.value.token})}return(H,k)=>(l(),d(U,null,[r("div",ps,[r("figure",fs,[h(Wt)])]),r("div",hs,[r("div",gs,[r("h2",null,_(o(v)("Meeting")),1),r("div",_s,[(l(!0),d(U,null,ae(F.value.participants,T=>(l(),N(ge,{key:T.user_id,src:`${o(y).avatars[T.user_id][32]}`,status:void 0,size:"1.5rem",class:E(["cursor-pointer",T.in_meeting?"":"leftConference"]),title:o(f)(T.user_id)},null,8,["src","class","title"]))),128)),o(Gt)(F.value.status,u.message.created_at)?(l(),d("p",ys,_(o(v)("Ended")),1)):(l(),d("button",{key:1,class:"primary-btn text-uppercase",onClick:A},_(o(v)("Join")),1))])])])],64))}}),Ss=Q(bs,[["__scopeId","data-v-4944ff12"]]),Is={class:"author"},ws={class:"avatar"},Cs=["title"],ks={class:"bubble"},Ts=K({__name:"BaseChatCall",props:{message:{},loggedUserId:{}},setup(S){const u=S,{t:v}=he(),y=D(()=>JSON.parse(u.message.content)),w=D(()=>{if(y.value.status=="FINISHED"){const f=y.value.duration;return f<60*se.Second?I(f,"'"+v("Lasted")+"' s 'sec'"):f<60*se.Minute?I(f,"'"+v("Lasted")+"' m 'min' s 'sec'"):I(f,"'"+v("Lasted")+"' h 'hour' m 'min' s 'sec'")}return v(pt.capitalize(y.value.status))});return(f,F)=>(l(),d(U,null,[r("div",Is,[r("figure",ws,[h(Zt)])]),r("div",{class:"contents",title:u.message.src_user===f.loggedUserId?o(v)("Called From")+" "+y.value.src_number:o(v)("Received From")+" "+y.value.dst_number},[r("div",ks,[r("h2",null,_(o(v)("Call")),1),r("p",null,[h(xe,{name:u.message.src_user===f.loggedUserId?"arrow-up-right":"arrow-down-left",size:12},null,8,["name"]),X(" "+_(u.message.src_user===f.loggedUserId?y.value.dst_number:y.value.src_number)+" â€¢ "+_(w.value),1)])])],8,Cs)],64))}}),$s=Q(Ts,[["__scopeId","data-v-1f34798c"]]),Ds={class:"base-chat-container"},Ns=["data-message"],Hs=["data-message"],Bs=K({__name:"BaseChat",props:{chatMessages:{},height:{}},setup(S){ft(t=>({"5d8d03b0":t.height}));const u=te(),v=Ze(),{isTyping:y}=et(),w=g(""),f=g(),F=D(()=>y.value(w.value,f.value));function A(t){const e=te();switch(t.type){case"conference":return t.src_user===e.user.userId?"my party meeting item":"party meeting item";case"call":return t.src_user===e.user.userId?"my call item":"party call item";default:return t.src_user===e.user.userId?"my message item":"party message item"}}const H=D(()=>(t,e)=>{if(t.length===1||e===0)return!0;const m=I(new Date(t[e].created_at),"dd-MM-yyyy"),O=I(new Date(t[e-1].created_at),"dd-MM-yyyy");return m!==O}),k=D(()=>(t,e)=>{if(t.length===1||e===0)return!0;const m=t[e].type,O=t[e-1].type,P=I(new Date(t[e].created_at),"dd-MM-yyyy"),R=I(new Date(t[e-1].created_at),"dd-MM-yyyy"),z=t[e].src_user,q=t[e-1].src_user;if(m!=="message"||O!=="message"||m!==O||z!==q||P!==R)return!0;const Y=I(new Date(t[e].created_at),"hh:mm"),V=I(new Date(t[e-1].created_at),"hh:mm");return Y!==V}),T=D(()=>(t,e)=>{const s=t.length-1;if(t.length===1||s===e)return!0;const m=t[e].type,O=t[e+1].type,P=I(new Date(t[e].created_at),"dd-MM-yyyy"),R=I(new Date(t[e+1].created_at),"dd-MM-yyyy"),z=t[e].src_user,q=t[e+1].src_user;if(m!=="message"||O!=="message"||m!==O||z!==q||P!==R)return!0;const Y=I(new Date(t[e].created_at),"hh:mm"),V=I(new Date(t[e+1].created_at),"hh:mm");return Y!==V}),M=D(()=>(t,e)=>e?!0:t.some(s=>s.status!=="failed"));return ht(()=>{w.value=v.name,f.value=parseInt(v.params.id,10)}),(t,e)=>(l(),d("div",Ds,[(l(!0),d(U,null,ae(t.chatMessages,(s,m)=>(l(),d(U,{key:s.id},[H.value(t.chatMessages,m)?(l(),N(Et,{key:0,"date-string":s.created_at},null,8,["date-string"])):p("",!0),s.type=="message"||s.type=="attachment"?(l(),N(vs,{key:1,"has-avatar":k.value(t.chatMessages,m),"has-time":T.value(t.chatMessages,m),me:o(u).user.userId===s.src_user,"chat-message":s},null,8,["has-avatar","has-time","me","chat-message"])):p("",!0),s.type=="conference"?(l(),d("div",{key:2,"data-message":s.id,class:E(A(s))},[h(Ss,{message:s},null,8,["message"])],10,Ns)):p("",!0),s.type==="call"?(l(),d("div",{key:3,"data-message":s.id,class:E(A(s))},[h($s,{"logged-user-id":o(u).user.userId,message:s},null,8,["logged-user-id","message"])],10,Hs)):p("",!0),s.type==="sms"&&M.value(JSON.parse(s.content).status,o(u).user.userId===s.src_user)?(l(),N(es,{key:4,id:s.id,date:s.created_at,message:JSON.parse(s.content).content,me:o(u).user.userId===s.src_user,status:JSON.parse(s.content).status,"src-user":s.src_user,"dst-number":JSON.parse(s.content).dst_number,"src-number":JSON.parse(s.content).src_number},null,8,["id","date","message","me","status","src-user","dst-number","src-number"])):p("",!0),s.type!=="sms"&&s.type!=="message"&&s.type!=="attachment"?(l(),N(tt,{key:5,"date-string":s.created_at,class:E(A(s))},null,8,["date-string","class"])):p("",!0)],64))),128)),F.value?(l(),N(Xt,{key:0,class:E({"mt-3":t.chatMessages.length===0}),"user-id":Number(f.value)},null,8,["class","user-id"])):p("",!0)]))}}),Fs=Q(Bs,[["__scopeId","data-v-a44d78d3"]]),As=S=>(Ge("data-v-9915f5dc"),S=S(),Xe(),S),Os={id:"chat-container"},Us={class:"chat-header"},Es={class:"chat-header-left"},Vs={class:"chat-header-right chat-actions"},Ls=["disabled"],Js={class:"chat-body-outer d-flex"},Ms={class:"loading-messages"},zs={class:"chat-body-inner w-100"},js={class:"chat-sidebar"},Ps={class:"info-group"},Rs={class:"info-group"},qs={class:"info-group"},Ys=["href"],Ws={class:"info-group"},Gs=As(()=>r("br",null,null,-1)),Xs={key:0},Ks={key:0,class:"me-1"},Qs={key:1},Zs={key:0,class:"me-1"},xs={key:2},ea=K({__name:"ChatView",setup(S){const u=Ze(),v=gt(),y=te(),w=Ke(),f=_t(),F=yt(),A=bt(),H=St(),{t:k}=he(),{resize:T}=Vt(),{newCall:M}=Pt(),t=g(),e=g(""),s=g(!1),{newConferenceIO:m}=Qe(),{newMessage:O,getSyncInitial:P,getBatchOfMessages:R,messagesRead:z,getOldMessages:q,searchMessage:Y}=It(),V=wt(),{isTyping:st}=et(),C=g(),re=g(!1),j=g(!0),L=g(!1),ne=g(0),oe=g(0),_e=g(),B=g(0),ye=g(!0),le=g(!1);window.addEventListener("online",ue),window.addEventListener("offline",ue);const at=setInterval(async()=>{ue()},3e4);async function ue(){const n=await Ct();n&&ye.value===!1&&me(),ye.value=n}const ce=D(()=>{const n=u.name,a=parseInt(u.params.id,10);return st.value(n,a)}),i=D(()=>{var a;const n=((a=u==null?void 0:u.params)==null?void 0:a.id)??0;return w.directories[parseInt(n)]}),ie=g(!1),Z=D(()=>{const n=y.teams.find(a=>{var c;return a.userId.toString()===((c=t.value)==null?void 0:c.userId.toString())});return n?n.assignedNumbers.map(a=>a.number):[]}),de=D(()=>{const n=Ye.collect(V.current_chat.messages).sortBy("created_at").all();return n.map(a=>(a.day=I(new Date(a.created_at),"yyyyMMdd"),a.minute=I(new Date(a.created_at),"HHmm"),a)),n.length&&V.setDataUser(i.value.userId,n[0].created_at,n[n.length-1].created_at),Ye.collect(n).all()});function rt(){if(F.userAgentArray.length===0)return Nt(k("No active number"));if(Z.value.length>1){s.value=!0;return}M(Z.value[0],F.userAgentActive)}function nt(){var n;(n=document.querySelector(".chat-body-outer"))==null||n.classList.toggle("show-sidebar")}function be(){e.value=u.params.id,e.value&&(t.value=y.directory(e.value.toString()))}async function ot(){var n,a,c;if((n=t.value)!=null&&n.favorite)return await Ht((a=t.value)==null?void 0:a.userId.toString()),u.name===We.FavoriteDirectory&&v.replace({name:We.Directory,params:{id:e.value}}),t.value.favorite=!1;await Bt((c=t.value)==null?void 0:c.userId.toString(),"user"),t.value.favorite=!0}function lt(){m(parseInt(e.value))}function me(){j.value=!0,ie.value=!0,V.initializeNewChatUser(parseInt(e.value)),re.value=!0;const n=u.query.dateCondition,a=u.query.messageId;n?Y(parseInt(e.value),n):P(parseInt(e.value)),setTimeout(()=>{j.value=!1,a&&(W(a),window.history.pushState({},document.title,window.location.pathname))},500),ie.value=!1}function W(n=""){setTimeout(()=>{var a;if(C.value){const c=n?mt(n):(a=C.value)==null?void 0:a.$el.scrollHeight;C.value.$el.scrollTop=c-C.value.$el.clientHeight}},100)}ee(()=>u.params,(n,a)=>{Object.prototype.hasOwnProperty.call(u.params,"id")&&n.id!==a.id&&(w.enableScrollLock(),be(),me())},{deep:!0}),ee(()=>V.current_chat.messages,(n,a)=>{var J,G;i.value&&i.value.userId&&z(i.value.userId);const c=(((J=C.value)==null?void 0:J.$el.scrollHeight)??0)-(((G=C.value)==null?void 0:G.$el.clientHeight)??0),b=u.query.messageId;Ft(()=>{if(!L.value&&B.value>=.95*c&&!b&&W(),a.length===0&&setTimeout(()=>{if(j.value=!1,!b)return W();W(b),window.history.pushState({},document.title,window.location.pathname)},500),n.length>0&&a.length>0&&L.value&&!le.value){const x=C.value.$el.scrollHeight-oe.value;C.value.$el.scrollTop=ne.value+x}})},{deep:!0}),kt(()=>{be(),me()}),Tt(()=>{clearInterval(at)});async function ut(n){clearTimeout(_e.value),w.disableScrollLock();const a=n.target;B.value=a.scrollTop;const c=a.scrollHeight;L.value||(B.value<=.15*c&&B.value>=.1*c||B.value===0)&&(L.value=!0,ne.value=B.value,oe.value=c,await q(i.value.userId),setTimeout(()=>{L.value=!1},2.5*se.Second))}function ct(n){if(clearTimeout(_e.value),re.value){re.value=!1;return}if(L.value)return;const a=n.target,c=a.offsetHeight;B.value=a.scrollTop;const b=a.scrollHeight;c+B.value>=.85*b&&c+B.value<=.95*b&&(L.value=!0,le.value=!0,ne.value=B.value,oe.value=b,z(i.value.userId),R(i.value.userId,"newest"),setTimeout(()=>{L.value=!1,le.value=!1},2.5*se.Second)),c+B.value>=.98*b&&w.enableScrollLock()}const Se=g(),it=g(0),{width:dt}=$t(Se);ee(dt,n=>it.value=n),ee(ce,n=>{var c,b;const a=(((c=C.value)==null?void 0:c.$el.scrollHeight)??0)-(((b=C.value)==null?void 0:b.$el.clientHeight)??0);n&&B.value>=.95*a&&W()});function mt(n){const a=document.querySelector(`[data-message="${n}"]`);let c=0;if(a){const b=a.offsetTop,J=a.clientHeight;c=b+J}return c>0?c:0}function vt(n){if(C.value){const a=C.value.$el.scrollTop;C.value.$el.scrollTop=a+n}}return Dt(()=>{T()}),(n,a)=>{var b,J,G;const c=At("perfect-scrollbar");return l(),d(U,null,[r("main",Os,[r("div",{ref_key:"panelRef",ref:Se,class:"panel"},[r("div",Us,[r("div",Es,[h(xt),r("div",{class:"contact-info",onClick:nt},[h(ge,{src:`${o(w).avatars[i.value.userId][32]}`,size:"1.5rem",status:((J=(b=o(f))==null?void 0:b.status[i.value.userId])==null?void 0:J.status)??"offline"},null,8,["src","status"]),h(o(ss),{as:"h2",size:16,weight:700,color:"brand-blue-500",class:"m-0"},{default:ve(()=>[X(_(i.value.userName),1)]),_:1})]),o(A).hasCallPresence(e.value)?(l(!0),d(U,{key:0},ae(o(A).callsPresence[e.value],$=>(l(),d(U,{key:$.callId},[$.state!=="terminated"?(l(),N(as,{key:0,state:$.state,"local-number":$.localNumber,"remote-number":$.remoteNumber,direction:$.direction,"user-id":e.value},null,8,["state","local-number","remote-number","direction","user-id"])):p("",!0)],64))),128)):p("",!0),o(H).presenceForVideo[parseInt(e.value,10)]==="on"?(l(),N(rs,{key:1})):p("",!0)]),r("div",Vs,[r("ul",null,[r("li",{onClick:ot},[r("button",{href:"javascript:",class:E(["favorite-container",{"is-favorite":(G=t.value)==null?void 0:G.favorite}])},[h(Lt,{class:"yellow"}),h(Jt,{class:"blue"})],2)]),r("li",null,[r("button",{href:"javascript:",class:"call-container",disabled:Z.value.length===0,onClick:rt},[h(Mt)],8,Ls)]),r("li",null,[r("button",{href:"javascript:",class:"meeting-container",onClick:a[0]||(a[0]=$=>lt())},[h(zt)])])])])]),r("div",Js,[pe(r("div",Ms,[h(xe,{name:"loader",class:"feather feather-loader spin",size:"md",color:o(Ot).SPAPrimary},null,8,["color"])],512),[[fe,j.value]]),pe(h(Kt,null,null,512),[[fe,!j.value&&!Object.keys(de.value).length&&!ce.value]]),pe(r("div",zs,[h(c,{ref_key:"scrollbar",ref:C,"watch-options":!0,options:{suppressScrollY:ie.value},onPsScrollUp:ut,onPsScrollDown:ct},{default:ve(()=>[h(Fs,{"chat-messages":de.value},null,8,["chat-messages"])]),_:1},8,["options"])],512),[[fe,!j.value&&Object.keys(de.value).length||ce.value]]),r("div",js,[h(c,null,{default:ve(()=>{var $,x,Ie,we,Ce,ke,Te,$e,De,Ne,He,Be,Fe,Ae,Oe,Ue,Ee,Ve,Le,Je,Me,ze,je,Pe,Re,qe;return[r("div",Ps,[r("h2",null,_(o(k)("Name")),1),r("p",null,_(i.value.userName),1)]),r("div",Rs,[r("h2",null,_(o(k)("Position")),1),r("p",null,_((x=($=i.value)==null?void 0:$.settings)==null?void 0:x.jobTitle),1)]),r("div",qs,[r("h2",null,_(o(k)("Email")),1),r("p",null,[r("a",{href:"mailto:"+((we=(Ie=i.value)==null?void 0:Ie.settings)==null?void 0:we.email)},_((ke=(Ce=i.value)==null?void 0:Ce.settings)==null?void 0:ke.email),9,Ys)])]),r("div",Ws,[r("h2",null,_(o(k)("Address")),1),r("p",null,[X(_(($e=(Te=i.value)==null?void 0:Te.settings)==null?void 0:$e.address1),1),Gs,(Ne=(De=i.value)==null?void 0:De.settings)!=null&&Ne.address2?(l(),d("span",Xs,[X(_((Be=(He=i.value)==null?void 0:He.settings)==null?void 0:Be.address2),1),(Ae=(Fe=i.value)==null?void 0:Fe.settings)!=null&&Ae.city||(Ue=(Oe=i.value)==null?void 0:Oe.settings)!=null&&Ue.state?(l(),d("span",Ks,",")):p("",!0)])):p("",!0),(Ve=(Ee=i.value)==null?void 0:Ee.settings)!=null&&Ve.city?(l(),d("span",Qs,[X(_((Je=(Le=i.value)==null?void 0:Le.settings)==null?void 0:Je.city),1),(ze=(Me=i.value)==null?void 0:Me.settings)!=null&&ze.state?(l(),d("span",Zs,",")):p("",!0)])):p("",!0),(Pe=(je=i.value)==null?void 0:je.settings)!=null&&Pe.state?(l(),d("span",xs,_((qe=(Re=i.value)==null?void 0:Re.settings)==null?void 0:qe.state),1)):p("",!0)])])]}),_:1})])]),h(jt,{onHeight:vt})],512)]),h(ts,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=$=>s.value=$),numbers:Z.value},null,8,["modelValue","numbers"])],64)}}}),Sa=Q(ea,[["__scopeId","data-v-9915f5dc"]]);export{Sa as default};
//# sourceMappingURL=ChatView-eZ8cOyZV.js.map
